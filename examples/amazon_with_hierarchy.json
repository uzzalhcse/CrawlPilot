{
  "name": "Amazon Bestsellers with URL Hierarchy",
  "description": "Crawls Amazon bestsellers with proper URL type categorization",
  "start_urls": [
    "https://www.amazon.com/Best-Sellers/zgbs"
  ],
  "max_depth": 4,
  "nodes": [
    {
      "id": "navigate_home",
      "type": "navigate",
      "params": {
        "wait_for": "#zg_browseRoot",
        "timeout": 15000
      }
    },
    {
      "id": "discover_main_categories",
      "type": "extract_links",
      "params": {
        "selector": "#zg_browseRoot .zg_browseRoot a",
        "url_type": "category",
        "filter": {
          "pattern": ".*Best-Sellers.*",
          "exclude_pattern": ".*ref=.*",
          "max_links": 30
        }
      },
      "depends_on": ["navigate_home"]
    },
    {
      "id": "navigate_category",
      "type": "navigate",
      "params": {
        "wait_for": ".zg-grid-general-faceout",
        "timeout": 15000
      },
      "depends_on": ["discover_main_categories"]
    },
    {
      "id": "discover_subcategories",
      "type": "extract_links",
      "params": {
        "selector": "#zg_browseRoot ul li a",
        "url_type": "subcategory",
        "filter": {
          "pattern": ".*Best-Sellers.*",
          "max_links": 20
        }
      },
      "depends_on": ["navigate_category"]
    },
    {
      "id": "discover_products",
      "type": "extract_links",
      "params": {
        "selector": ".zg-grid-general-faceout a.a-link-normal",
        "url_type": "product",
        "filter": {
          "pattern": ".*/dp/.*",
          "exclude_pattern": ".*offer-listing.*",
          "max_links": 100
        }
      },
      "depends_on": ["navigate_category"]
    },
    {
      "id": "discover_pagination",
      "type": "extract_links",
      "params": {
        "selector": ".a-pagination .a-last a, .a-pagination li:not(.a-disabled) a",
        "url_type": "pagination",
        "filter": {
          "pattern": ".*pg=.*"
        }
      },
      "depends_on": ["navigate_category"]
    },
    {
      "id": "navigate_product",
      "type": "navigate",
      "params": {
        "wait_for": "#productTitle",
        "timeout": 15000
      },
      "depends_on": ["discover_products"]
    },
    {
      "id": "extract_product_data",
      "type": "extract_data",
      "params": {
        "schema": "amazon_product",
        "fields": {
          "title": {
            "selector": "#productTitle",
            "type": "text",
            "transform": "trim"
          },
          "price": {
            "selector": ".a-price .a-offscreen, #priceblock_ourprice, #priceblock_dealprice",
            "type": "text",
            "transform": "extract_number"
          },
          "currency": {
            "selector": ".a-price .a-offscreen",
            "type": "text",
            "transform": "extract_currency",
            "default": "USD"
          },
          "rating": {
            "selector": "#acrPopover .a-icon-alt, .a-icon-star .a-icon-alt",
            "type": "text",
            "transform": "extract_rating"
          },
          "review_count": {
            "selector": "#acrCustomerReviewText",
            "type": "text",
            "transform": "extract_number"
          },
          "availability": {
            "selector": "#availability span",
            "type": "text",
            "transform": "trim"
          },
          "brand": {
            "selector": "#bylineInfo",
            "type": "text",
            "transform": "trim"
          },
          "asin": {
            "selector": "input[name='ASIN']",
            "type": "attribute",
            "attribute": "value"
          },
          "bestseller_rank": {
            "selector": "#SalesRank, #productDetails_detailBullets_sections1 tr:contains('Best Sellers Rank') td",
            "type": "text"
          },
          "features": {
            "selector": "#feature-bullets li span",
            "type": "list"
          },
          "image_url": {
            "selector": "#landingImage",
            "type": "attribute",
            "attribute": "src"
          }
        }
      },
      "depends_on": ["navigate_product"]
    }
  ],
  "settings": {
    "concurrent_requests": 2,
    "request_delay": 2000,
    "retry_attempts": 3,
    "respect_robots_txt": true,
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
  }
}
