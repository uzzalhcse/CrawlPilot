# Oxylabs Sandbox E-commerce Full Site Crawler
# Crawls https://sandbox.oxylabs.io/products with pagination and product details

start_urls:
  - "https://sandbox.oxylabs.io/products"

max_depth: 3
max_pages: 500
rate_limit_delay: 2000

headers:
  User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
  Accept: "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"
  Accept-Language: "en-US,en;q=0.9"

# URL Discovery: Navigate through product listings and pagination
url_discovery:
  - id: "wait_for_page_load"
    type: "wait_for"
    name: "Wait for page to load"
    params:
      selector: "body"
      timeout: 10000
      state: "visible"

  - id: "wait_for_products"
    type: "wait_for"
    name: "Wait for product grid"
    params:
      selector: ".product-card, .product, [class*='product']"
      timeout: 15000
      state: "visible"
    optional: true
    dependencies:
      - "wait_for_page_load"

  - id: "scroll_page"
    type: "scroll"
    name: "Scroll to load lazy content"
    params:
      x: 0
      y: 1000
    dependencies:
      - "wait_for_products"
    optional: true

  - id: "wait_after_scroll"
    type: "wait"
    name: "Wait after scroll"
    params:
      duration: 2000
    dependencies:
      - "scroll_page"
    optional: true

  - id: "extract_product_links"
    type: "extract_links"
    name: "Extract product page links"
    params:
      selector: "a[href*='/products/']"
    output_key: "product_urls"
    dependencies:
      - "wait_after_scroll"

  - id: "extract_category_links"
    type: "extract_links"
    name: "Extract category links"
    params:
      selector: "a[href*='/categories/'], a[href*='/category/']"
    output_key: "category_urls"
    optional: true
    dependencies:
      - "wait_after_scroll"

  - id: "extract_pagination_links"
    type: "extract_links"
    name: "Extract pagination links"
    params:
      selector: "a[href*='page='], .pagination a, nav a, a[rel='next']"
    output_key: "pagination_urls"
    dependencies:
      - "wait_after_scroll"

# Data Extraction: Extract comprehensive product information
data_extraction:
  - id: "wait_for_product_details"
    type: "wait_for"
    name: "Wait for product details"
    params:
      selector: "body"
      timeout: 10000
      state: "visible"

  - id: "extract_product_title"
    type: "extract"
    name: "Extract product title"
    params:
      selector: "h1, .product-title, [class*='title'], .product-name"
      type: "text"
      transform:
        - type: "trim"
      default_value: ""
    output_key: "title"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_price"
    type: "extract"
    name: "Extract product price"
    params:
      selector: ".price, [class*='price'], .product-price, span[class*='price']"
      type: "text"
      transform:
        - type: "trim"
        - type: "regex"
          params:
            pattern: "[^0-9.]"
            replacement: ""
      default_value: "0"
    output_key: "price"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_description"
    type: "extract"
    name: "Extract product description"
    params:
      selector: ".description, .product-description, [class*='description'], p"
      type: "text"
      transform:
        - type: "trim"
      default_value: ""
    output_key: "description"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_image"
    type: "extract"
    name: "Extract product main image"
    params:
      selector: ".product-image img, .main-image img, img[class*='product']"
      type: "src"
      default_value: ""
    output_key: "image_url"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_images"
    type: "extract"
    name: "Extract all product images"
    params:
      selector: ".product-images img, .gallery img, img"
      type: "src"
      multiple: true
      default_value: []
    output_key: "images"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_sku"
    type: "extract"
    name: "Extract product SKU"
    params:
      selector: ".sku, [class*='sku'], .product-code"
      type: "text"
      transform:
        - type: "trim"
      default_value: ""
    output_key: "sku"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_category"
    type: "extract"
    name: "Extract product category"
    params:
      selector: ".category, .breadcrumb, [class*='category']"
      type: "text"
      transform:
        - type: "trim"
      default_value: ""
    output_key: "category"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_brand"
    type: "extract"
    name: "Extract product brand"
    params:
      selector: ".brand, [class*='brand'], .manufacturer"
      type: "text"
      transform:
        - type: "trim"
      default_value: ""
    output_key: "brand"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_rating"
    type: "extract"
    name: "Extract product rating"
    params:
      selector: ".rating, [class*='rating'], .stars"
      type: "text"
      transform:
        - type: "trim"
        - type: "regex"
          params:
            pattern: "[^0-9.]"
            replacement: ""
      default_value: "0"
    output_key: "rating"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_product_reviews"
    type: "extract"
    name: "Extract number of reviews"
    params:
      selector: ".reviews-count, [class*='review'], .review-count"
      type: "text"
      transform:
        - type: "trim"
        - type: "regex"
          params:
            pattern: "[^0-9]"
            replacement: ""
      default_value: "0"
    output_key: "review_count"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_availability"
    type: "extract"
    name: "Extract product availability"
    params:
      selector: ".availability, .stock, [class*='stock']"
      type: "text"
      transform:
        - type: "trim"
        - type: "lowercase"
      default_value: "unknown"
    output_key: "availability"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_meta_description"
    type: "extract"
    name: "Extract meta description"
    params:
      selector: "meta[name='description']"
      type: "attr"
      attribute: "content"
      default_value: ""
    output_key: "meta_description"
    optional: true
    dependencies:
      - "wait_for_product_details"

  - id: "extract_all_text"
    type: "extract"
    name: "Extract all text content"
    params:
      selector: "body"
      type: "text"
      transform:
        - type: "trim"
      default_value: ""
    output_key: "full_text"
    optional: true
    dependencies:
      - "wait_for_product_details"

# Storage configuration
storage:
  type: "database"
  table_name: "oxylabs_products"
